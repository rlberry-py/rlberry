

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <title>Visualization of policies and plots of training/evaluation metrics in rlberry &mdash; rlberry 0.7.3.post16.dev0+8710009 documentation</title>
  
  <link rel="canonical" href="https://rlberry-py.github.io/rlberry/basics/userguide/visualization.html" />

  

  <link rel="stylesheet" href="../../_static/css/vendor/bootstrap.min.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery-dataframe.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery-rendered-html.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sphinx-design.4cbf315f70debaebd550c87a6162cf0f.min.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
<script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
<script src="../../_static/js/vendor/jquery-3.6.3.slim.min.js"></script> 
</head>
<body>


<nav id="navbar" class="sk-docs-navbar navbar navbar-expand-md navbar-light bg-light py-0">
  <div class="container-fluid sk-docs-container px-0">
    <button
      id="sk-navbar-toggler"
      class="navbar-toggler"
      type="button"
      data-toggle="collapse"
      data-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="sk-navbar-collapse collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item">
          <a class="sk-nav-link nav-link" href="../../index.html">Home</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link" href="../../installation.html">Install</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link" href="../../user_guide.html">User Guide</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link" href="../../auto_examples/index.html">Examples</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link" href="../../api.html">API</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link" href="../../changelog.html">Changelog</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link" href="../../about.html">About</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link" href="https://github.com/rlberry-py/rlberry">GitHub</a>
        </li>
        <!--
        <li class="nav-item dropdown nav-more-item-dropdown">
          <a class="sk-nav-link nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">More</a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdown">
          </div>
        </li>-->
    </ul>
      <div id="searchbox" role="search">
          <div class="searchformwrapper">
            <form action="https://duckduckgo.com/">
            <input type="hidden" id="sites" name="sites" value="https://rlberry-py.github.io/rlberry/">
            <input type="search" placeholder="Search &hellip;" value="" name="q" />
            <input class="sk-search-text-btn" type="submit" value="Go" /></form>

          </div>
      </div>
    </div>
  </div>
</nav>
<div class="d-flex" id="sk-doc-wrapper">
    <input type="checkbox" name="sk-toggle-checkbox" id="sk-toggle-checkbox">
    <label id="sk-sidemenu-toggle" class="sk-btn-toggle-toc btn sk-btn-primary" for="sk-toggle-checkbox">Toggle Menu</label>
    <div id="sk-sidebar-wrapper" class="border-right">
      <div class="sk-sidebar-toc-wrapper">
        <div class="sk-sidebar-toc-logo">
        </div>
	<br>
        <div class="alert alert-warning p-1 mb-2" role="alert">

          <p class="text-center mb-0">
          rlberry 0.7.3.post16.dev0+8710009<br/>
          <a href="../../versions.html">Other versions</a>
          </p>

        </div>
            <div class="sk-sidebar-toc">
              <ul>
<li><a class="reference internal" href="#">Visualization of policies and plots of training/evaluation metrics in rlberry</a><ul>
<li><a class="reference internal" href="#generating-videos-and-gif-of-the-policy-of-a-trained-agent">Generating videos and gif of the policy of a trained agent</a><ul>
<li><a class="reference internal" href="#generating-videos">Generating videos</a></li>
<li><a class="reference internal" href="#generating-gifs-with-rlberry-scool-env">Generating gifs with rlberry_scool env</a></li>
<li><a class="reference internal" href="#generating-gifs-with-gymnasium-env">Generating gifs with Gymnasium env</a></li>
</ul>
</li>
<li><a class="reference internal" href="#plotting-training-data-and-reward-curves-in-rlberry">Plotting training data and reward curves in rlberry</a><ul>
<li><a class="reference internal" href="#plotting-raw-curves">Plotting raw curves</a></li>
<li><a class="reference internal" href="#error-representation-confidence-intervals-and-prediction-intervals">Error representation – confidence intervals and prediction intervals</a></li>
</ul>
</li>
<li><a class="reference internal" href="#visualization-of-evaluations-of-trained-agents-in-rlberry">Visualization of evaluations of trained agents in rlberry</a></li>
</ul>
</li>
</ul>

            </div>
      </div>
    </div>
    <div id="sk-page-content-wrapper">
      <div class="sk-page-content container-fluid body px-md-3" role="main">
        
  <section id="visualization-of-policies-and-plots-of-training-evaluation-metrics-in-rlberry">
<span id="visu-userguide"></span><h1>Visualization of policies and plots of training/evaluation metrics in rlberry<a class="headerlink" href="#visualization-of-policies-and-plots-of-training-evaluation-metrics-in-rlberry" title="Permalink to this heading">¶</a></h1>
<p>Good plots and visualization tools are important to design, debug and assess the performance of a RL algorithm.</p>
<ul class="simple">
<li><p><strong>Visualization of the policy of a trained agent</strong>. With gymnasium, it is customary to render the video of an episode of a trained agent, typically with gymnasium’s <a class="reference external" href="https://gymnasium.farama.org/api/wrappers/misc_wrappers/#gymnasium.wrappers.RecordVideo">RecordVideo</a> wrapper. This wrapper can be used in rlberry, but we also have another tool that allow us to render the videos as a gif for some simple environments (Chain and Gridworld from <a class="reference external" href="https://github.com/rlberry-py/rlberry-scool/tree/main/rlberry_scool/envs/finite">rlberry-scool</a>) as it may be more adapted in some cases (no need for ffmpeg and video codecs).</p></li>
<li><p><strong>Visualizing training metrics</strong>. In rlberry, all the training data acquisition is done via the writer and we then use mainly the function <a class="reference internal" href="../../generated/rlberry.manager.plot_writer_data.html#rlberry.manager.plot_writer_data" title="rlberry.manager.plot_writer_data"><code class="xref py py-mod docutils literal notranslate"><span class="pre">rlberry.manager.plot_writer_data</span></code></a> in order to plot the resulting metrics as they are recorded during training.</p></li>
<li><p><strong>Visualizing evaluations of a trained agent</strong>. The user can generate evaluation data for trained agents and plot the resulting evaluation boxplots with <a class="reference internal" href="../../generated/rlberry.manager.evaluate_agents.html#rlberry.manager.evaluate_agents" title="rlberry.manager.evaluate_agents"><code class="xref py py-mod docutils literal notranslate"><span class="pre">rlberry.manager.evaluate_agents</span></code></a>.</p></li>
</ul>
<section id="generating-videos-and-gif-of-the-policy-of-a-trained-agent">
<h2>Generating videos and gif of the policy of a trained agent<a class="headerlink" href="#generating-videos-and-gif-of-the-policy-of-a-trained-agent" title="Permalink to this heading">¶</a></h2>
<section id="generating-videos">
<h3>Generating videos<a class="headerlink" href="#generating-videos" title="Permalink to this heading">¶</a></h3>
<p>To generate a video, we typically use a wrapper around the environment that will record what is happening in the environment and then we generate a video from these recordings. To do that with gymnasium, see  <a class="reference external" href="https://gymnasium.farama.org/api/wrappers/misc_wrappers/#gymnasium.wrappers.RecordVideo">RecordVideo</a> wrapper, and for a use-case with rlberry see for instance our <a class="reference external" href="https://rlberry-py.github.io/rlberry/auto_examples/demo_agents/video_plot_dqn.html#sphx-glr-auto-examples-demo-agents-video-plot-dqn-py">DQN on CartPole example</a>.</p>
</section>
<section id="generating-gifs-with-rlberry-scool-env">
<h3>Generating gifs with rlberry_scool env<a class="headerlink" href="#generating-gifs-with-rlberry-scool-env" title="Permalink to this heading">¶</a></h3>
<p>Sometimes, it may be easier to use gif instead of videos (for teaching for instance, in order not to have to ask students to install ffmpeg on their computers). To do this, we have the tool <code class="xref py py-mod docutils literal notranslate"><span class="pre">rlberry.rendering.utils.gif_write</span></code> that works for rlberry-scool environments <code class="docutils literal notranslate"><span class="pre">rlberry_scool.envs.Chain</span></code> and <code class="docutils literal notranslate"><span class="pre">rlberry_scool.envs.Gridworld</span></code> in the following way:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rlberry.agents</span> <span class="kn">import</span> <span class="n">AgentWithSimplePolicy</span>
<span class="kn">from</span> <span class="nn">rlberry_scool.envs</span> <span class="kn">import</span> <span class="n">Chain</span>

<span class="n">env_ctor</span> <span class="o">=</span> <span class="n">Chain</span>
<span class="n">env_kwargs</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">(</span><span class="n">L</span><span class="o">=</span><span class="mi">10</span><span class="p">,</span> <span class="n">fail_prob</span><span class="o">=</span><span class="mf">0.1</span><span class="p">)</span>
<span class="c1"># chain of length 10. With proba 0.1, the agent will not be able to take the action it wants to take.</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">env_ctor</span><span class="p">(</span><span class="o">**</span><span class="n">env_kwargs</span><span class="p">)</span>
<span class="n">env</span><span class="o">.</span><span class="n">enable_rendering</span><span class="p">()</span>
<span class="n">observation</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">5</span><span class="p">):</span>
    <span class="n">observation</span><span class="p">,</span> <span class="n">reward</span><span class="p">,</span> <span class="n">terminated</span><span class="p">,</span> <span class="n">truncated</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
    <span class="n">done</span> <span class="o">=</span> <span class="n">terminated</span> <span class="ow">or</span> <span class="n">truncated</span>
<span class="n">env</span><span class="o">.</span><span class="n">save_gif</span><span class="p">(</span><span class="s2">&quot;gif_chain.gif&quot;</span><span class="p">)</span>
<span class="c1"># clear rendering data</span>
<span class="n">env</span><span class="o">.</span><span class="n">clear_render_buffer</span><span class="p">()</span>
<span class="n">env</span><span class="o">.</span><span class="n">disable_rendering</span><span class="p">()</span>
</pre></div>
</div>
<p><img alt="" src="../../_images/gif_chain.gif" /></p>
<p>The tool <code class="docutils literal notranslate"><span class="pre">save_gif</span></code> works by collecting all the frames generated by the steps of <code class="docutils literal notranslate"><span class="pre">env</span></code> for each of the steps done after <code class="docutils literal notranslate"><span class="pre">env.enable_rendering()</span></code>.</p>
</section>
<section id="generating-gifs-with-gymnasium-env">
<h3>Generating gifs with Gymnasium env<a class="headerlink" href="#generating-gifs-with-gymnasium-env" title="Permalink to this heading">¶</a></h3>
<p>If you want to use the <code class="docutils literal notranslate"><span class="pre">save_gif</span></code> tool with a gymnasium environment, you need to :</p>
<ul class="simple">
<li><p>Use the <a class="reference internal" href="../../generated/rlberry.envs.gym_make.html#rlberry.envs.gym_make" title="rlberry.envs.gym_make"><code class="xref py py-mod docutils literal notranslate"><span class="pre">rlberry.envs.gym_make</span></code></a> function to create the (wrapped) environment.</p></li>
<li><p>Use <code class="docutils literal notranslate"><span class="pre">render_mode</span> <span class="pre">=</span> <span class="pre">&quot;rgb_array&quot;</span></code> as parameter to create the environment. More information <a class="reference external" href="https://gymnasium.farama.org/api/env/#gymnasium.Env.render">here</a>.</p></li>
</ul>
<p>An example here :</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rlberry.envs</span> <span class="kn">import</span> <span class="n">gym_make</span>
<span class="kn">from</span> <span class="nn">rlberry.seeding</span> <span class="kn">import</span> <span class="n">Seeder</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<span class="n">seeder</span> <span class="o">=</span> <span class="n">Seeder</span><span class="p">(</span><span class="mi">123</span><span class="p">)</span>
<span class="n">env</span> <span class="o">=</span> <span class="n">gym_make</span><span class="p">(</span><span class="s2">&quot;MountainCar-v0&quot;</span><span class="p">,</span> <span class="n">render_mode</span><span class="o">=</span><span class="s2">&quot;rgb_array&quot;</span><span class="p">)</span>
<span class="n">env</span><span class="o">.</span><span class="n">reseed</span><span class="p">(</span><span class="n">seeder</span><span class="p">)</span>


<span class="n">env</span><span class="o">.</span><span class="n">enable_rendering</span><span class="p">()</span>
<span class="n">observation</span><span class="p">,</span> <span class="n">info</span> <span class="o">=</span> <span class="n">env</span><span class="o">.</span><span class="n">reset</span><span class="p">()</span>
<span class="k">for</span> <span class="n">tt</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span>
    <span class="n">action</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="mi">1</span><span class="p">)</span>
    <span class="n">env</span><span class="o">.</span><span class="n">step</span><span class="p">(</span><span class="n">action</span><span class="p">)</span>

<span class="n">saving_path</span> <span class="o">=</span> <span class="s2">&quot;./visu_gymnasium_gif.gif&quot;</span>
<span class="n">env</span><span class="o">.</span><span class="n">save_gif</span><span class="p">(</span><span class="n">saving_path</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="" src="../../_images/visu_gymnasium_gif.gif" /></p>
</section>
</section>
<section id="plotting-training-data-and-reward-curves-in-rlberry">
<h2>Plotting training data and reward curves in rlberry<a class="headerlink" href="#plotting-training-data-and-reward-curves-in-rlberry" title="Permalink to this heading">¶</a></h2>
<p>Training metrics in reinforcement learning are typically very unstable because there is randomness in the training process (e.g. neural networks) and the environment changes during the training. Then, if a single plot is very non-smooth due to the process variablility, it may become necessary to smooth the curve in order to be able to get any information from it.</p>
<p>Plotting training metric in rlberry goes through the use of <a class="reference internal" href="../../generated/rlberry.manager.plot_writer_data.html#rlberry.manager.plot_writer_data" title="rlberry.manager.plot_writer_data"><code class="xref py py-mod docutils literal notranslate"><span class="pre">rlberry.manager.plot_writer_data</span></code></a>. The function can take as first argument either a trained rlberry agent (whose writer contains the training data) or a pandas dataframe containing the training data. The dataframe is supposed to adhere to rlberry format and must contain the columns <code class="docutils literal notranslate"><span class="pre">tag</span></code> (description of value being stored), <code class="docutils literal notranslate"><span class="pre">value</span></code> (the value), a column with the x-axis (whose name must be fed to the <code class="docutils literal notranslate"><span class="pre">xtag</span></code> parameter), <code class="docutils literal notranslate"><span class="pre">n_simu</span></code> (identifier for which training this corresponds to if there are several), <code class="docutils literal notranslate"><span class="pre">name</span></code> (name of the agent).</p>
<p>There are two type of plots that can be done with rlberry: synchronized plots are plots in which the x coordinate for each curve are the same, for instance this is what happens if the x coordinate are the steps in the environment (the variable called <code class="docutils literal notranslate"><span class="pre">global_step</span></code>). On the other hand, when the curves are not synchronized (for instance if the x coordinates are the wall time, then two separate training will give different x coordinates) we need to smooth the curves before doing any kind of aggregation. This distinction is done through the use of the <code class="docutils literal notranslate"><span class="pre">smooth</span></code> parameter in <a class="reference internal" href="../../generated/rlberry.manager.plot_writer_data.html#rlberry.manager.plot_writer_data" title="rlberry.manager.plot_writer_data"><code class="xref py py-mod docutils literal notranslate"><span class="pre">rlberry.manager.plot_writer_data</span></code></a> using the library <a class="reference external" href="https://github.com/GAA-UAM/scikit-fda">scikit-fda</a>.</p>
<section id="plotting-raw-curves">
<h3>Plotting raw curves<a class="headerlink" href="#plotting-raw-curves" title="Permalink to this heading">¶</a></h3>
<p>If there are very few curves and they are not too “rugged”, they can be plotted directly through the parameter <code class="docutils literal notranslate"><span class="pre">error_representation=&quot;raw_curves&quot;</span></code>. In deep blue is plotted the mean curve, averaged over the training and in light blue are the inidividual curves for each training.  We give here an example of the plot of the entropy loss function for stablebaselines3 PPO agent on CartPole-v1 environment.</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rlberry.envs</span> <span class="kn">import</span> <span class="n">gym_make</span>
<span class="kn">from</span> <span class="nn">stable_baselines3</span> <span class="kn">import</span> <span class="n">PPO</span>
<span class="kn">from</span> <span class="nn">rlberry.agents.stable_baselines</span> <span class="kn">import</span> <span class="n">StableBaselinesAgent</span>
<span class="kn">from</span> <span class="nn">rlberry.manager</span> <span class="kn">import</span> <span class="n">ExperimentManager</span><span class="p">,</span> <span class="n">plot_writer_data</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">env_ctor</span><span class="p">,</span> <span class="n">env_kwargs</span> <span class="o">=</span> <span class="n">gym_make</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;CartPole-v1&quot;</span><span class="p">)</span>

<span class="n">manager</span> <span class="o">=</span> <span class="n">ExperimentManager</span><span class="p">(</span>
    <span class="n">StableBaselinesAgent</span><span class="p">,</span>
    <span class="p">(</span><span class="n">env_ctor</span><span class="p">,</span> <span class="n">env_kwargs</span><span class="p">),</span>
    <span class="n">agent_name</span><span class="o">=</span><span class="s2">&quot;PPO&quot;</span><span class="p">,</span>
    <span class="n">fit_budget</span><span class="o">=</span><span class="mf">5e4</span><span class="p">,</span>
    <span class="n">init_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;algo_cls&quot;</span><span class="p">:</span> <span class="n">PPO</span><span class="p">,</span> <span class="s2">&quot;policy&quot;</span><span class="p">:</span> <span class="s2">&quot;MlpPolicy&quot;</span><span class="p">,</span> <span class="s2">&quot;verbose&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
    <span class="n">n_fit</span><span class="o">=</span><span class="mi">3</span><span class="p">,</span>
<span class="p">)</span>

<span class="n">manager</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>

<span class="n">plot_writer_data</span><span class="p">(</span>
    <span class="p">[</span><span class="n">manager</span><span class="p">],</span>
    <span class="s2">&quot;train/entropy_loss&quot;</span><span class="p">,</span>
    <span class="n">xtag</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span>
    <span class="n">error_representation</span><span class="o">=</span><span class="s2">&quot;raw_curves&quot;</span><span class="p">,</span>
    <span class="n">smooth</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span>
<span class="p">)</span>  <span class="c1"># xtag = None will use global_step as x-axis</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;entropy_loss.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="" src="../../_images/entropy_loss.png" /></p>
</section>
<section id="error-representation-confidence-intervals-and-prediction-intervals">
<h3>Error representation – confidence intervals and prediction intervals<a class="headerlink" href="#error-representation-confidence-intervals-and-prediction-intervals" title="Permalink to this heading">¶</a></h3>
<p>If the number curves becomes large, you may want to aggregate the curves and render an error bar using one of the available error representations.</p>
<p>We now explicit the various ways to represent the vertical errorbars of a curve in rlberry. Example of code to do these various plots is available in the example section: <a class="reference internal" href="../../auto_examples/plot_smooth.html#sphx-glr-auto-examples-plot-smooth-py"><span class="std std-ref">Illustration of plotting tools on Bandits</span></a>.</p>
<a class="reference external image-reference" href="../../auto_examples/plot_smooth.html"><img alt="../../_images/sphx_glr_plot_smooth_002.png" class="align-center" src="../../_images/sphx_glr_plot_smooth_002.png" /></a>
<p>There are several error representation availables in <a class="reference internal" href="../../generated/rlberry.manager.plot_writer_data.html#rlberry.manager.plot_writer_data" title="rlberry.manager.plot_writer_data"><code class="xref py py-mod docutils literal notranslate"><span class="pre">rlberry.manager.plot_writer_data</span></code></a>:</p>
<ul class="simple">
<li><p><code class="docutils literal notranslate"><span class="pre">error_representation=&quot;cb&quot;</span></code> is a confidence band on the mean curve using functional data analysis (band in which the mean curve is with probability larger than 1-level). Available only for smoothed curves, this is a simultaneous confidence interval along the whole curve and should be prefered to “ci” when possible because it allows us to interpret the whole curve simultaneously. See the docstring of <code class="docutils literal notranslate"><span class="pre">plot_writer_data</span></code> for details on this method.</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">error_representation=&quot;ci&quot;</span></code> is a confidence interval around the mean curve. We use a Gaussian model around the mean smoothed curve (e.g. we do curve plus/minus gaussian quantile times std divided by sqrt of number of seeds).</p></li>
<li><p><code class="docutils literal notranslate"><span class="pre">error_representation=&quot;pi&quot;</span></code> is a plot of a non-simultaneous prediction interval with gaussian model around the mean smoothed curve (e.g. we do curve plus/minus gaussian quantile times std).</p></li>
</ul>
</section>
</section>
<section id="visualization-of-evaluations-of-trained-agents-in-rlberry">
<h2>Visualization of evaluations of trained agents in rlberry<a class="headerlink" href="#visualization-of-evaluations-of-trained-agents-in-rlberry" title="Permalink to this heading">¶</a></h2>
<p>Once agents are trained, you may want to compare their evaluations on environments. This is done through <a class="reference internal" href="../../generated/rlberry.manager.evaluate_agents.html#rlberry.manager.evaluate_agents" title="rlberry.manager.evaluate_agents"><code class="xref py py-mod docutils literal notranslate"><span class="pre">rlberry.manager.evaluate_agents</span></code></a>, this function takes as input a list of <a class="reference internal" href="../../generated/rlberry.manager.ExperimentManager.html#rlberry.manager.ExperimentManager" title="rlberry.manager.ExperimentManager"><code class="xref py py-mod docutils literal notranslate"><span class="pre">rlberry.manager.ExperimentManager</span></code></a> and plot the boxplots of the evaluations of each agent. If there are several fits for the agent in the experiment manager, an agent is chosen at random at each iteration (you can use the parameter <code class="docutils literal notranslate"><span class="pre">choose_random_agents</span></code> to change this behavior).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">rlberry.agents.stable_baselines</span> <span class="kn">import</span> <span class="n">StableBaselinesAgent</span>
<span class="kn">from</span> <span class="nn">stable_baselines3</span> <span class="kn">import</span> <span class="n">PPO</span><span class="p">,</span> <span class="n">A2C</span>
<span class="kn">from</span> <span class="nn">rlberry.manager</span> <span class="kn">import</span> <span class="n">ExperimentManager</span><span class="p">,</span> <span class="n">evaluate_agents</span>
<span class="kn">from</span> <span class="nn">rlberry.envs</span> <span class="kn">import</span> <span class="n">gym_make</span>
<span class="kn">import</span> <span class="nn">matplotlib.pyplot</span> <span class="k">as</span> <span class="nn">plt</span>

<span class="n">names</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;A2C&quot;</span><span class="p">,</span> <span class="s2">&quot;PPO&quot;</span><span class="p">]</span>
<span class="n">managers</span> <span class="o">=</span> <span class="p">[</span>
    <span class="n">ExperimentManager</span><span class="p">(</span>
        <span class="n">StableBaselinesAgent</span><span class="p">,</span>
        <span class="p">(</span><span class="n">gym_make</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;Acrobot-v1&quot;</span><span class="p">)),</span>
        <span class="n">fit_budget</span><span class="o">=</span><span class="mf">1e5</span><span class="p">,</span>
        <span class="n">agent_name</span><span class="o">=</span><span class="n">names</span><span class="p">[</span><span class="n">i</span><span class="p">],</span>
        <span class="n">eval_kwargs</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">eval_horizon</span><span class="o">=</span><span class="mi">500</span><span class="p">),</span>
        <span class="n">init_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s2">&quot;algo_cls&quot;</span><span class="p">:</span> <span class="n">algo_cls</span><span class="p">,</span> <span class="s2">&quot;policy&quot;</span><span class="p">:</span> <span class="s2">&quot;MlpPolicy&quot;</span><span class="p">,</span> <span class="s2">&quot;verbose&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">},</span>
        <span class="n">n_fit</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
        <span class="n">seed</span><span class="o">=</span><span class="mi">42</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">algo_cls</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">([</span><span class="n">A2C</span><span class="p">,</span> <span class="n">PPO</span><span class="p">])</span>
<span class="p">]</span>
<span class="k">for</span> <span class="n">manager</span> <span class="ow">in</span> <span class="n">managers</span><span class="p">:</span>
    <span class="n">manager</span><span class="o">.</span><span class="n">fit</span><span class="p">()</span>
<span class="n">data</span> <span class="o">=</span> <span class="n">evaluate_agents</span><span class="p">(</span><span class="n">managers</span><span class="p">,</span> <span class="n">n_simulations</span><span class="o">=</span><span class="mi">50</span><span class="p">)</span>
<span class="n">plt</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s2">&quot;example_eval.png&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p><img alt="" src="../../_images/example_eval.png" /></p>
</section>
</section>


      </div>
    <div class="container">
      <footer class="sk-content-footer">
            &copy; 2023, rlberry team.
          <a href="../../_sources/basics/userguide/visualization.md.txt" rel="nofollow">Show this page source</a>
      </footer>
    </div>
  </div>
</div>
<script src="../../_static/js/vendor/bootstrap.min.js"></script>

<script>
    window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
    ga('create', 'UA-22606712-2', 'auto');
    ga('set', 'anonymizeIp', true);
    ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


<script>
$(document).ready(function() {
    /* Add a [>>>] button on the top-right corner of code samples to hide
     * the >>> and ... prompts and the output and thus make the code
     * copyable. */
    var div = $('.highlight-python .highlight,' +
                '.highlight-python3 .highlight,' +
                '.highlight-pycon .highlight,' +
		'.highlight-default .highlight')
    var pre = div.find('pre');

    // get the styles from the current theme
    pre.parent().parent().css('position', 'relative');
    var hide_text = 'Hide prompts and outputs';
    var show_text = 'Show prompts and outputs';

    // create and add the button to all the code blocks that contain >>>
    div.each(function(index) {
        var jthis = $(this);
        if (jthis.find('.gp').length > 0) {
            var button = $('<span class="copybutton">&gt;&gt;&gt;</span>');
            button.attr('title', hide_text);
            button.data('hidden', 'false');
            jthis.prepend(button);
        }
        // tracebacks (.gt) contain bare text elements that need to be
        // wrapped in a span to work with .nextUntil() (see later)
        jthis.find('pre:has(.gt)').contents().filter(function() {
            return ((this.nodeType == 3) && (this.data.trim().length > 0));
        }).wrap('<span>');
    });

    // define the behavior of the button when it's clicked
    $('.copybutton').click(function(e){
        e.preventDefault();
        var button = $(this);
        if (button.data('hidden') === 'false') {
            // hide the code output
            button.parent().find('.go, .gp, .gt').hide();
            button.next('pre').find('.gt').nextUntil('.gp, .go').css('visibility', 'hidden');
            button.css('text-decoration', 'line-through');
            button.attr('title', show_text);
            button.data('hidden', 'true');
        } else {
            // show the code output
            button.parent().find('.go, .gp, .gt').show();
            button.next('pre').find('.gt').nextUntil('.gp, .go').css('visibility', 'visible');
            button.css('text-decoration', 'none');
            button.attr('title', hide_text);
            button.data('hidden', 'false');
        }
    });

	/*** Add permalink buttons next to glossary terms ***/
	$('dl.glossary > dt[id]').append(function() {
		return ('<a class="headerlink" href="#' +
			    this.getAttribute('id') +
			    '" title="Permalink to this term">¶</a>');
	});
  /*** Hide navbar when scrolling down ***/
  // Returns true when headerlink target matches hash in url
  (function() {
    hashTargetOnTop = function() {
        var hash = window.location.hash;
        if ( hash.length < 2 ) { return false; }

        var target = document.getElementById( hash.slice(1) );
        if ( target === null ) { return false; }

        var top = target.getBoundingClientRect().top;
        return (top < 2) && (top > -2);
    };

    // Hide navbar on load if hash target is on top
    var navBar = document.getElementById("navbar");
    var navBarToggler = document.getElementById("sk-navbar-toggler");
    var navBarHeightHidden = "-" + navBar.getBoundingClientRect().height + "px";
    var $window = $(window);

    hideNavBar = function() {
        navBar.style.top = navBarHeightHidden;
    };

    showNavBar = function() {
        navBar.style.top = "0";
    }

    if (hashTargetOnTop()) {
        hideNavBar()
    }

    var prevScrollpos = window.pageYOffset;
    hideOnScroll = function(lastScrollTop) {
        if (($window.width() < 768) && (navBarToggler.getAttribute("aria-expanded") === 'true')) {
            return;
        }
        if (lastScrollTop > 2 && (prevScrollpos <= lastScrollTop) || hashTargetOnTop()){
            hideNavBar()
        } else {
            showNavBar()
        }
        prevScrollpos = lastScrollTop;
    };

    /*** high performance scroll event listener***/
    var raf = window.requestAnimationFrame ||
        window.webkitRequestAnimationFrame ||
        window.mozRequestAnimationFrame ||
        window.msRequestAnimationFrame ||
        window.oRequestAnimationFrame;
    var lastScrollTop = $window.scrollTop();

    if (raf) {
        loop();
    }

    function loop() {
        var scrollTop = $window.scrollTop();
        if (lastScrollTop === scrollTop) {
            raf(loop);
            return;
        } else {
            lastScrollTop = scrollTop;
            hideOnScroll(lastScrollTop);
            raf(loop);
        }
    }
  })();
});

</script>
    
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
    
</body>
</html>