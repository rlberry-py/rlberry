

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta name="generator" content="Docutils 0.19: https://docutils.sourceforge.io/" />

  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  
  <title>Adaptive hypothesis testing for comparison of RL agents with AdaStop &mdash; rlberry 0.7.3.post16.dev0+8710009 documentation</title>
  
  <link rel="canonical" href="https://rlberry-py.github.io/rlberry/basics/userguide/adastop.html" />

  

  <link rel="stylesheet" href="../../_static/css/vendor/bootstrap.min.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery-binder.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery-dataframe.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sg_gallery-rendered-html.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/sphinx-design.4cbf315f70debaebd550c87a6162cf0f.min.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
<script id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
<script src="../../_static/js/vendor/jquery-3.6.3.slim.min.js"></script> 
</head>
<body>


<nav id="navbar" class="sk-docs-navbar navbar navbar-expand-md navbar-light bg-light py-0">
  <div class="container-fluid sk-docs-container px-0">
    <button
      id="sk-navbar-toggler"
      class="navbar-toggler"
      type="button"
      data-toggle="collapse"
      data-target="#navbarSupportedContent"
      aria-controls="navbarSupportedContent"
      aria-expanded="false"
      aria-label="Toggle navigation"
    >
      <span class="navbar-toggler-icon"></span>
    </button>

    <div class="sk-navbar-collapse collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav mr-auto">
        <li class="nav-item">
          <a class="sk-nav-link nav-link" href="../../index.html">Home</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link" href="../../installation.html">Install</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link" href="../../user_guide.html">User Guide</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link" href="../../auto_examples/index.html">Examples</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link" href="../../api.html">API</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link" href="../../changelog.html">Changelog</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link" href="../../about.html">About</a>
        </li>
        <li class="nav-item">
          <a class="sk-nav-link nav-link" href="https://github.com/rlberry-py/rlberry">GitHub</a>
        </li>
        <!--
        <li class="nav-item dropdown nav-more-item-dropdown">
          <a class="sk-nav-link nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">More</a>
          <div class="dropdown-menu" aria-labelledby="navbarDropdown">
          </div>
        </li>-->
    </ul>
      <div id="searchbox" role="search">
          <div class="searchformwrapper">
            <form action="https://duckduckgo.com/">
            <input type="hidden" id="sites" name="sites" value="https://rlberry-py.github.io/rlberry/">
            <input type="search" placeholder="Search &hellip;" value="" name="q" />
            <input class="sk-search-text-btn" type="submit" value="Go" /></form>

          </div>
      </div>
    </div>
  </div>
</nav>
<div class="d-flex" id="sk-doc-wrapper">
    <input type="checkbox" name="sk-toggle-checkbox" id="sk-toggle-checkbox">
    <label id="sk-sidemenu-toggle" class="sk-btn-toggle-toc btn sk-btn-primary" for="sk-toggle-checkbox">Toggle Menu</label>
    <div id="sk-sidebar-wrapper" class="border-right">
      <div class="sk-sidebar-toc-wrapper">
        <div class="sk-sidebar-toc-logo">
        </div>
	<br>
        <div class="alert alert-warning p-1 mb-2" role="alert">

          <p class="text-center mb-0">
          rlberry 0.7.3.post16.dev0+8710009<br/>
          <a href="../../versions.html">Other versions</a>
          </p>

        </div>
            <div class="sk-sidebar-toc">
              <ul>
<li><a class="reference internal" href="#">Adaptive hypothesis testing for comparison of RL agents with AdaStop</a><ul>
<li><a class="reference internal" href="#hypothesis-testing-to-compare-rl-agents">Hypothesis testing to compare RL agents</a></li>
<li><a class="reference internal" href="#comparison-of-a2c-and-ppo-from-stable-baselines3">Comparison of A2C and PPO from stable-baselines3</a></li>
<li><a class="reference internal" href="#result-visualisation">Result visualisation</a></li>
</ul>
</li>
</ul>

            </div>
      </div>
    </div>
    <div id="sk-page-content-wrapper">
      <div class="sk-page-content container-fluid body px-md-3" role="main">
        
  <section id="adaptive-hypothesis-testing-for-comparison-of-rl-agents-with-adastop">
<span id="adastop-userguide"></span><h1>Adaptive hypothesis testing for comparison of RL agents with AdaStop<a class="headerlink" href="#adaptive-hypothesis-testing-for-comparison-of-rl-agents-with-adastop" title="Permalink to this heading">¶</a></h1>
<section id="hypothesis-testing-to-compare-rl-agents">
<h2>Hypothesis testing to compare RL agents<a class="headerlink" href="#hypothesis-testing-to-compare-rl-agents" title="Permalink to this heading">¶</a></h2>
<p>AdaStop is a Sequential testing for efficient and reliable comparison of stochastic algorithms first introduced in <a class="reference external" href="https://arxiv.org/abs/2306.10882">https://arxiv.org/abs/2306.10882</a>.</p>
<p>This section explains how to use the AdaStop algorithm in rlberry. AdaStop implements a sequential statistical test using group sequential permutation test and is especially adapted to multiple testing with very small sample size. The main library for AdaStop is in <a class="reference external" href="https://github.com/TimotheeMathieu/adastop">https://github.com/TimotheeMathieu/adastop</a> but for comparison of RL agents, it is easier to use rlberry bindings.</p>
<p>We use AdaStop in particular to to adaptively choose the number of training necessary to get a statistically significant decision on a comparison of algorithms. The rationale is that when the returns of some experiment in computer science is stochastic, it becomes necessary to make the same experiment several time in order to have a viable comparison of the algorithms and be able to rank them with a theoretically controlled family-wise error rate. Adastop allows us to choose the number of repetition adaptively to stop collecting data as soon as possible. Please note, that what we call here algorithm is really a certain implementation of an algorithm.</p>
</section>
<section id="comparison-of-a2c-and-ppo-from-stable-baselines3">
<h2>Comparison of A2C and PPO from stable-baselines3<a class="headerlink" href="#comparison-of-a2c-and-ppo-from-stable-baselines3" title="Permalink to this heading">¶</a></h2>
<p>Below, we compare A2C and PPO agents from stable-baselines3 on Acrobot environment. We limit the maximum number of trainings for each agent to <span class="math notranslate nohighlight">\(5\times 5 = 25\)</span>, using <span class="math notranslate nohighlight">\(5\)</span> batches of size <span class="math notranslate nohighlight">\(5\)</span>. We ask that the resulting test has a level of <span class="math notranslate nohighlight">\(99%\)</span> (i.e. the probability to wrongly say that the agents are different is <span class="math notranslate nohighlight">\(1%\)</span>).</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span><span class="w"> </span><span class="nn">rlberry.envs</span><span class="w"> </span><span class="kn">import</span> <span class="n">gym_make</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">stable_baselines3</span><span class="w"> </span><span class="kn">import</span> <span class="n">A2C</span><span class="p">,</span> <span class="n">PPO</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rlberry.agents.stable_baselines</span><span class="w"> </span><span class="kn">import</span> <span class="n">StableBaselinesAgent</span>
<span class="kn">from</span><span class="w"> </span><span class="nn">rlberry.manager</span><span class="w"> </span><span class="kn">import</span> <span class="n">AdastopComparator</span>

<span class="n">env_ctor</span><span class="p">,</span> <span class="n">env_kwargs</span> <span class="o">=</span> <span class="n">gym_make</span><span class="p">,</span> <span class="nb">dict</span><span class="p">(</span><span class="nb">id</span><span class="o">=</span><span class="s2">&quot;CartPole-v1&quot;</span><span class="p">)</span>

<span class="n">managers</span> <span class="o">=</span> <span class="p">[</span>
    <span class="p">{</span>
        <span class="s2">&quot;agent_class&quot;</span><span class="p">:</span> <span class="n">StableBaselinesAgent</span><span class="p">,</span>
        <span class="s2">&quot;train_env&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">env_ctor</span><span class="p">,</span> <span class="n">env_kwargs</span><span class="p">),</span>
        <span class="s2">&quot;fit_budget&quot;</span><span class="p">:</span> <span class="mf">5e4</span><span class="p">,</span>
        <span class="s2">&quot;agent_name&quot;</span><span class="p">:</span> <span class="s2">&quot;A2C&quot;</span><span class="p">,</span>
        <span class="s2">&quot;init_kwargs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;algo_cls&quot;</span><span class="p">:</span> <span class="n">A2C</span><span class="p">,</span> <span class="s2">&quot;policy&quot;</span><span class="p">:</span> <span class="s2">&quot;MlpPolicy&quot;</span><span class="p">,</span> <span class="s2">&quot;verbose&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
    <span class="p">},</span>
    <span class="p">{</span>
        <span class="s2">&quot;agent_class&quot;</span><span class="p">:</span> <span class="n">StableBaselinesAgent</span><span class="p">,</span>
        <span class="s2">&quot;train_env&quot;</span><span class="p">:</span> <span class="p">(</span><span class="n">env_ctor</span><span class="p">,</span> <span class="n">env_kwargs</span><span class="p">),</span>
        <span class="s2">&quot;agent_name&quot;</span><span class="p">:</span> <span class="s2">&quot;PPO&quot;</span><span class="p">,</span>
        <span class="s2">&quot;fit_budget&quot;</span><span class="p">:</span> <span class="mf">5e4</span><span class="p">,</span>
        <span class="s2">&quot;init_kwargs&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;algo_cls&quot;</span><span class="p">:</span> <span class="n">PPO</span><span class="p">,</span> <span class="s2">&quot;policy&quot;</span><span class="p">:</span> <span class="s2">&quot;MlpPolicy&quot;</span><span class="p">,</span> <span class="s2">&quot;verbose&quot;</span><span class="p">:</span> <span class="mi">1</span><span class="p">},</span>
    <span class="p">},</span>
<span class="p">]</span>

<span class="n">comparator</span> <span class="o">=</span> <span class="n">AdastopComparator</span><span class="p">(</span><span class="n">n</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">K</span><span class="o">=</span><span class="mi">5</span><span class="p">,</span> <span class="n">alpha</span><span class="o">=</span><span class="mf">0.01</span><span class="p">)</span>
<span class="n">comparator</span><span class="o">.</span><span class="n">compare</span><span class="p">(</span><span class="n">managers</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">comparator</span><span class="o">.</span><span class="n">managers_paths</span><span class="p">)</span>
</pre></div>
</div>
</section>
<section id="result-visualisation">
<h2>Result visualisation<a class="headerlink" href="#result-visualisation" title="Permalink to this heading">¶</a></h2>
<p>The results of the comparison can be obtained either in text format using <code class="docutils literal notranslate"><span class="pre">print_results</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">comparator</span><span class="o">.</span><span class="n">print_results</span><span class="p">()</span>
</pre></div>
</div>
<p>The result is found using 10 scores for each agent:</p>
<div class="highlight-python3 notranslate"><div class="highlight"><pre><span></span><span class="n">Number</span> <span class="n">of</span> <span class="n">scores</span> <span class="n">used</span> <span class="k">for</span> <span class="n">each</span> <span class="n">agent</span><span class="p">:</span>
<span class="n">A2C</span><span class="p">:</span><span class="mi">10</span>
<span class="n">PPO</span><span class="p">:</span><span class="mi">10</span>

<span class="n">Mean</span> <span class="n">of</span> <span class="n">scores</span> <span class="n">of</span> <span class="n">each</span> <span class="n">agent</span><span class="p">:</span>
<span class="n">A2C</span><span class="p">:</span><span class="mf">271.17600000000004</span>
<span class="n">PPO</span><span class="p">:</span><span class="mf">500.0</span>

<span class="n">Decision</span> <span class="k">for</span> <span class="n">each</span> <span class="n">comparison</span><span class="p">:</span>
<span class="n">A2C</span> <span class="n">vs</span> <span class="n">PPO</span><span class="p">:</span><span class="n">smaller</span>
</pre></div>
</div>
<p>or with a plot using <code class="docutils literal notranslate"><span class="pre">plot_results</span></code></p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="n">comparator</span><span class="o">.</span><span class="n">plot_results</span><span class="p">()</span>
</pre></div>
</div>
<p><img alt="" src="../../_images/adastop_boxplots.png" /></p>
<p>The boxplots in the plot represent the distribution of the scores gathered for each agent. The table on the top of the figure represent the decisions taken by the test: larger, smaller or equal.</p>
</section>
</section>


      </div>
    <div class="container">
      <footer class="sk-content-footer">
            &copy; 2023, rlberry team.
          <a href="../../_sources/basics/userguide/adastop.md.txt" rel="nofollow">Show this page source</a>
      </footer>
    </div>
  </div>
</div>
<script src="../../_static/js/vendor/bootstrap.min.js"></script>

<script>
    window.ga=window.ga||function(){(ga.q=ga.q||[]).push(arguments)};ga.l=+new Date;
    ga('create', 'UA-22606712-2', 'auto');
    ga('set', 'anonymizeIp', true);
    ga('send', 'pageview');
</script>
<script async src='https://www.google-analytics.com/analytics.js'></script>


<script>
$(document).ready(function() {
    /* Add a [>>>] button on the top-right corner of code samples to hide
     * the >>> and ... prompts and the output and thus make the code
     * copyable. */
    var div = $('.highlight-python .highlight,' +
                '.highlight-python3 .highlight,' +
                '.highlight-pycon .highlight,' +
		'.highlight-default .highlight')
    var pre = div.find('pre');

    // get the styles from the current theme
    pre.parent().parent().css('position', 'relative');
    var hide_text = 'Hide prompts and outputs';
    var show_text = 'Show prompts and outputs';

    // create and add the button to all the code blocks that contain >>>
    div.each(function(index) {
        var jthis = $(this);
        if (jthis.find('.gp').length > 0) {
            var button = $('<span class="copybutton">&gt;&gt;&gt;</span>');
            button.attr('title', hide_text);
            button.data('hidden', 'false');
            jthis.prepend(button);
        }
        // tracebacks (.gt) contain bare text elements that need to be
        // wrapped in a span to work with .nextUntil() (see later)
        jthis.find('pre:has(.gt)').contents().filter(function() {
            return ((this.nodeType == 3) && (this.data.trim().length > 0));
        }).wrap('<span>');
    });

    // define the behavior of the button when it's clicked
    $('.copybutton').click(function(e){
        e.preventDefault();
        var button = $(this);
        if (button.data('hidden') === 'false') {
            // hide the code output
            button.parent().find('.go, .gp, .gt').hide();
            button.next('pre').find('.gt').nextUntil('.gp, .go').css('visibility', 'hidden');
            button.css('text-decoration', 'line-through');
            button.attr('title', show_text);
            button.data('hidden', 'true');
        } else {
            // show the code output
            button.parent().find('.go, .gp, .gt').show();
            button.next('pre').find('.gt').nextUntil('.gp, .go').css('visibility', 'visible');
            button.css('text-decoration', 'none');
            button.attr('title', hide_text);
            button.data('hidden', 'false');
        }
    });

	/*** Add permalink buttons next to glossary terms ***/
	$('dl.glossary > dt[id]').append(function() {
		return ('<a class="headerlink" href="#' +
			    this.getAttribute('id') +
			    '" title="Permalink to this term">¶</a>');
	});
  /*** Hide navbar when scrolling down ***/
  // Returns true when headerlink target matches hash in url
  (function() {
    hashTargetOnTop = function() {
        var hash = window.location.hash;
        if ( hash.length < 2 ) { return false; }

        var target = document.getElementById( hash.slice(1) );
        if ( target === null ) { return false; }

        var top = target.getBoundingClientRect().top;
        return (top < 2) && (top > -2);
    };

    // Hide navbar on load if hash target is on top
    var navBar = document.getElementById("navbar");
    var navBarToggler = document.getElementById("sk-navbar-toggler");
    var navBarHeightHidden = "-" + navBar.getBoundingClientRect().height + "px";
    var $window = $(window);

    hideNavBar = function() {
        navBar.style.top = navBarHeightHidden;
    };

    showNavBar = function() {
        navBar.style.top = "0";
    }

    if (hashTargetOnTop()) {
        hideNavBar()
    }

    var prevScrollpos = window.pageYOffset;
    hideOnScroll = function(lastScrollTop) {
        if (($window.width() < 768) && (navBarToggler.getAttribute("aria-expanded") === 'true')) {
            return;
        }
        if (lastScrollTop > 2 && (prevScrollpos <= lastScrollTop) || hashTargetOnTop()){
            hideNavBar()
        } else {
            showNavBar()
        }
        prevScrollpos = lastScrollTop;
    };

    /*** high performance scroll event listener***/
    var raf = window.requestAnimationFrame ||
        window.webkitRequestAnimationFrame ||
        window.mozRequestAnimationFrame ||
        window.msRequestAnimationFrame ||
        window.oRequestAnimationFrame;
    var lastScrollTop = $window.scrollTop();

    if (raf) {
        loop();
    }

    function loop() {
        var scrollTop = $window.scrollTop();
        if (lastScrollTop === scrollTop) {
            raf(loop);
            return;
        } else {
            lastScrollTop = scrollTop;
            hideOnScroll(lastScrollTop);
            raf(loop);
        }
    }
  })();
});

</script>
    
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-chtml.js"></script>
    
</body>
</html>